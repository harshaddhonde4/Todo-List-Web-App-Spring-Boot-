<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List Manager</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-tasks"></i> Todo List Manager</h1>
            <div class="stats">
                <span class="stat-item">
                    <i class="fas fa-list"></i>
                    Total: <span th:text="${totalTodos}">0</span>
                </span>
                <span class="stat-item">
                    <i class="fas fa-clock"></i>
                    Pending: <span th:text="${pendingTodos}">0</span>
                </span>
                <span class="stat-item">
                    <i class="fas fa-check-circle"></i>
                    Completed: <span th:text="${completedTodos}">0</span>
                </span>
            </div>
        </header>

        <!-- Add New Todo Form -->
        <div class="add-todo-section">
            <h2>Add New Task</h2>
            <form th:action="@{/todos}" method="post" th:object="${newTodo}" class="todo-form">
                <div class="form-row">
                    <div class="form-group">
                        <input type="text" th:field="*{title}" placeholder="Task title..." required class="input-field">
                    </div>
                    <div class="form-group">
                        <select th:field="*{priority}" class="select-field">
                            <option value="LOW">Low Priority</option>
                            <option value="MEDIUM">Medium Priority</option>
                            <option value="HIGH">High Priority</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <textarea th:field="*{description}" placeholder="Task description (optional)..." class="textarea-field"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Task
                </button>
            </form>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-buttons">
                <a th:href="@{/todos}" class="btn btn-filter" th:classappend="${filter == 'all'} ? 'active' : ''">
                    <i class="fas fa-list"></i> All Tasks
                </a>
                <a th:href="@{/todos(filter='pending')}" class="btn btn-filter" th:classappend="${filter == 'pending'} ? 'active' : ''">
                    <i class="fas fa-clock"></i> Pending
                </a>
                <a th:href="@{/todos(filter='completed')}" class="btn btn-filter" th:classappend="${filter == 'completed'} ? 'active' : ''">
                    <i class="fas fa-check-circle"></i> Completed
                </a>
            </div>
        </div>

        <!-- Todo List -->
        <div class="todos-section">
            <div th:if="${#lists.isEmpty(todos)}" class="empty-state">
                <i class="fas fa-clipboard-list"></i>
                <h3>No tasks found</h3>
                <p th:if="${filter == 'all'}">Start by adding your first task above!</p>
                <p th:if="${filter == 'pending'}">All your tasks are completed! ðŸŽ‰</p>
                <p th:if="${filter == 'completed'}">No completed tasks yet. Get started!</p>
            </div>

            <div class="todo-grid">
                <div th:each="todo : ${todos}" class="todo-card" th:classappend="${todo.completed} ? 'completed' : ''">
                    <div class="todo-header">
                        <div class="todo-priority" th:classappend="${#strings.toLowerCase(todo.priority)}">
                            <span th:text="${todo.priority}">HIGH</span>
                        </div>
                        <div class="todo-actions">
                            <form th:action="@{/todos/{id}/toggle(id=${todo.id})}" method="post" style="display: inline;">
                                <button type="submit" class="btn-icon" th:title="${todo.completed} ? 'Mark as pending' : 'Mark as completed'">
                                    <i th:class="${todo.completed} ? 'fas fa-undo' : 'fas fa-check'"></i>
                                </button>
                            </form>
                            <a th:href="@{/todos/{id}/edit(id=${todo.id})}" class="btn-icon" title="Edit task">
                                <i class="fas fa-edit"></i>
                            </a>
                            <form th:action="@{/todos/{id}/delete(id=${todo.id})}" method="post" style="display: inline;" 
                                  onsubmit="return confirm('Are you sure you want to delete this task?');">
                                <button type="submit" class="btn-icon btn-danger" title="Delete task">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <div class="todo-content">
                        <h3 class="todo-title" th:text="${todo.title}">Task Title</h3>
                        <p class="todo-description" th:if="${!#strings.isEmpty(todo.description)}" th:text="${todo.description}">
                            Task Description
                        </p>
                    </div>
                    
                    <div class="todo-footer">
                        <span class="todo-status" th:text="${todo.completed} ? 'Completed' : 'Pending'">Pending</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>